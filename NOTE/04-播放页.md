音乐播放，跳转播放页。
- 创建 music-player 播放页，点击推荐歌曲（song-item-v1）或歌曲列表中的歌曲（song-item-v2）进行跳转。
- 跳转时，要获取到歌曲的 id，和歌曲列表两项数据。
- 考略到要获取歌曲列表，所以在 song-item-v1/song-item-v1 所在的页面（Page）中进行跳转，而非 song-item-v1 或 song-item-v2 组件。

在播放页 music-player 中根据 id 发送网络请求，获取歌曲信息和歌词信息。

pages\music-player\music-player.js

```js
import { getSongsInfo } from '../../services/modules/player'

Page({

  data: {
    id: 0, // 歌曲 id
    song: {}, // 歌曲
    durationTime: 0, // 歌曲时长
  },

	// -------------------- 生命周期 ----------------------

  onLoad(option) {
    // 获取传入的 id
    const id = option.id

    // 根据 id，播放歌曲
    this.playSong(id)
  },

	// -------------------- 自行封装 ----------------------

  playSong(id) {

    this.setData({ id })

    // 根据 id 获取歌曲的信息
    getSongsInfo(id).then(res => {
      console.log('song info res:', res)
      this.setData({
        song: res.songs[0],
        durationTime: res.songs[0].dt
      })
    })

  },

})
```

在播放页 music-play 需要使用自定义导航，

- 修改页面配置文件，开启自定义导航栏功能。

  pages\music-player\music-player.json

  ```json
  "navigationStyle": "custom",
  ```

- 创建 nav-bar 组件，用于自定义导航栏。

- 自定义导航栏需要给手机状态栏（电量，时间）预留高度。在页面配置文件修改状态栏字体的颜色。

  pages\music-player\music-player.json

  ```json
  "navigationBarTextStyle": "white",
  ```

- 在 nav-bar 组件中使用默认插槽给左边区域，中间区域预留要展示的内容。

- 给中间内容，插入歌曲歌词。

- 点击中间的“歌曲”/“歌词”，切换下方的轮播图。

app.js

```js
App({
	globalData: {
    screenWidth: 0,
    screenHeight: 0,
    statusBarHeight: 0,
    deviceRadio: 0,
    navBarHeight: 44, // 给手机顶部导航栏默认高度 44 px，用于播放页，自定义导航栏
  },

	onLaunch() {
    // 获取屏幕的长宽
    const info = wx.getSystemInfoSync();
    // 获取手机屏幕宽度。
    this.globalData.screenWidth = info.screenWidth
    // 获取手机屏幕高度
    this.globalData.screenHeight = info.screenHeight
    // 获取手机状态栏高度
    this.globalData.statusBarHeight = info.statusBarHeight
    // 获取手机高度/宽度比例。
    const deviceRadio = info.screenHeight / info.screenWidth
    this.globalData.deviceRadio = deviceRadio

  },
})
```

components\nav-bar\nav-bar.js

```js
const app = getApp()

Component({
  options: {
    multipleSlots: true, // 开启使用多个插槽的功能
  },
  properties: {
    title: {
      type: String,
      value: '默认标题'
    }
  },

  data: {
    statusBarHeight: 20,
    navBarHeight: 44,
  },

  methods: {
    handleBackArrowClick() {
      this.triggerEvent('click')
    },
  },

  lifetimes: {
    attached() {
      const { statusBarHeight, navBarHeight } = app.globalData
      this.setData({
        statusBarHeight,
        navBarHeight,
      })
    }
  },
})

```

components\nav-bar\nav-bar.wxml

```html
<view class="nav">
	<!-- 手机状态栏 -->
	<view style="height: {{ statusBarHeight }}px;"></view>
	<!-- 导航栏 -->
	<view class="nav-bar" style="height: {{ navBarHeight }}px;">
    <!-- 左边区域 -->
		<view class="left">
			<view class="slot">
				<slot name="left"></slot>
			</view>
			<view class="default" bindtap="handleBackArrowClick">
				<image class="icon" mode="widthFix" src="/assets/images/icons/arrow-left.png"/>
			</view>
		</view>
    <!-- 中间区域 -->
		<view class="center">
			<view class="slot">
				<slot name="center"></slot>
			</view>
			<view class="default">{{ title }}</view>
		</view>
    <!-- 右边区域 -->
		<view class="right"></view>
	</view>
</view>
```

在播放页 music-play 添加背景图，并铺上毛玻璃效果。

在播放页 music-play 使用轮播图 swiper 来搭建歌曲/歌词区域。
- 动态决定轮播图的高度（总结）：
> 在小程序中，没有自定义导航，windowHeight = screenHeight - 状态栏高度 - 默认导航栏高度
> 自定义导航：windowHeight = screenHeight

pages\music-player\music-player.js

```js
const app = getApp()

Page({
  onLoad(option) {
    // 获取设备信息
    const { contentHeight } = app.globalData
    console.log('contentHeight', contentHeight);
    this.setData({ contentHeight })
  }
})
```

pages\music-player\music-player.wxml

```html
<swiper
	class="content"
	style="height: {{ contentHeight }}px;"
/>
```

* 在播放页 music-play 为封面、标题，一句歌词、进度条，操作栏5各区域进行布局。
	- 使用 flex 布局，垂直方向布局，封面占据 flex: 1；下方区域由内容睁开。
* 在播放页 music-play，进入时，播放歌曲。在全局创建一个播放上下文实例就可以了，
	- 使用 `src` 属性传入音频连接进行播放。
	- 最好使用 `autoplay` 属性进行自动播放，不要使用 `play` 属性，会有一点问题。
	- 使用 `onTimeUpdata` 属性进行播放监听，使用 `currentTime` 属性（单位 ms）获取当前播放时间。
	- 在属性 `durationTime` 中可获取歌曲总时长，但也可以在请求结果中获取（单位 m），并设值到 data 中，在页面上进行展示。
	- 时间变化时，也移动滑块。
* 在播放页 music-play 点击滑块，改变歌曲进度。	
	- 使用实例 `seek()` 方法，改变播放时间（单位 ms）。
		- seek 操作后会遇到一个 bug，`currentTime `无法获取。
		- 原因是 seek 后，播放实例去缓存设值的进度，再播放时，实例的 `onTimeUpdata` 不再监听了。
		- 解决办法：
			- 在播放实例的 `onWaiting()` 回调函数中，调用实例的 `pause()` 方法；将播放暂停；
			- 再在 `onCanplay()` 回调函数中，调用实例的 `play()` 方法，继续播放。
* 在播放页 music-play 滑动滑块，改变歌曲进度。
	- 在滑动时，不改变播放进度，改变当前时间。松手后，再改变播放进度。
	- 需要搞一个变量来记录是否滑动滑块，滑动的时候播放实例不设置进度，但改变下方的当前时间；松手时，再设值播放进度。

